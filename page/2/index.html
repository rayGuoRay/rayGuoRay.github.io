<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />









  <link rel="shortcut icon" type="image/x-icon" href="/uploads/favicon.ico?v=5.1.1" />






<meta name="description" content="ç§~ä¸€åªé‡ç”ŸçŒ´å­ï¼">
<meta name="keywords" content="Android, Linux, Shell, Ubuntu, Git">
<meta property="og:type" content="website">
<meta property="og:title" content="Wizardiy">
<meta property="og:url" content="http://wizardiy.com/page/2/index.html">
<meta property="og:site_name" content="Wizardiy">
<meta property="og:description" content="ç§~ä¸€åªé‡ç”ŸçŒ´å­ï¼">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wizardiy">
<meta name="twitter:description" content="ç§~ä¸€åªé‡ç”ŸçŒ´å­ï¼">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wizardiy.com/page/2/"/>





  <title>Wizardiy</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wizardiy</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Wizardiy-Hexoæ­å»ºçš„å¯’çŸ³ã®åšå®¢</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wizardiy.com/2016/09/02/DownloadManager æºç åˆ†æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="å¯’çŸ³">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://orxuxhbm0.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wizardiy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/02/DownloadManager æºç åˆ†æ/" itemprop="url">Android N DownloadManager æºç åˆ†æ</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-09-02T22:18:56+08:00">
                2016-09-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æºç åˆ†æ/" itemprop="url" rel="index">
                    <span itemprop="name">æºç åˆ†æ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>DownloadManageræ˜¯Androidç”¨ç³»ç»ŸæœåŠ¡çš„æ–¹å¼æä¾›çš„ç”¨æ¥ä¼˜åŒ–å¤„ç†é•¿æ—¶é—´ä¸‹è½½ä»»åŠ¡çš„å·¥å…·ã€‚<br>æœ¬æ–‡å°†åŸºäºï¼¡ndroid ï¼®çš„æºç è¿›è¡Œåˆ†æã€‚</p>
<h3 id="DownloadManagerçš„ä½¿ç”¨æ–¹å¼"><a href="#DownloadManagerçš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="DownloadManagerçš„ä½¿ç”¨æ–¹å¼"></a>DownloadManagerçš„ä½¿ç”¨æ–¹å¼</h3><pre><code>DownloadManager downloadManager = (DownloadManager) context.getSystemService(Context.DOWNLOAD_SERVICE);
Uri uri = Uri.parse(&quot;downloadUrl&quot;);
DownloadManager.Request request = new Request(uri);
long reference = downloadManager.enqueue(request);
</code></pre><p>è°ƒç”¨enqueueæ–¹æ³•ä¹‹åï¼Œåªè¦æ•°æ®è¿æ¥å¯ç”¨å¹¶ä¸”Download Managerå¯ç”¨ï¼Œä¸‹è½½å°±ä¼šå¼€å§‹ã€‚<br>è¦åœ¨ä¸‹è½½å®Œæˆçš„æ—¶å€™è·å¾—ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼ˆnotificationï¼‰,æ³¨å†Œä¸€ä¸ªå¹¿æ’­æ¥å—è€…æ¥æ¥æ”¶ACTION_DOWNLOAD_COMPLETEå¹¿æ’­ï¼Œè¿™ä¸ªå¹¿æ’­ä¼šåŒ…å«ä¸€ä¸ªEXTRA_DOWNLOAD_IDä¿¡æ¯åœ¨intentä¸­åŒ…å«äº†å·²ç»å®Œæˆçš„è¿™ä¸ªä¸‹è½½çš„IDã€‚</p>
<p><em>å…¶ä»–æ›´è¯¦ç»†APIä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ<a href="http://blog.csdn.net/sir_zeng/article/details/8983430" target="_blank" rel="external">Android DownloadManagerçš„ä½¿ç”¨</a>ä¸€æ–‡,æ­¤å¤„ä¸å†è¯¦è¿°ã€‚</em></p>
<h3 id="DownloadManagerçš„è°ƒç”¨å¤„ç†"><a href="#DownloadManagerçš„è°ƒç”¨å¤„ç†" class="headerlink" title="DownloadManagerçš„è°ƒç”¨å¤„ç†"></a>DownloadManagerçš„è°ƒç”¨å¤„ç†</h3><p>DownloadManagerçš„æ‰§è¡Œå…¥å£æ–¹æ³•enqueueçš„æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>ContentValues values = request.toContentValues(mPackageName);
Uri downloadUri = mResolver.insert(Downloads.Impl.CONTENT_URI, values);
long id = Long.parseLong(downloadUri.getLastPathSegment());
return id;
</code></pre><p>å…¶ä¸­ï¼Œrequestä¸ºè¯·æ±‚åˆå§‹åŒ–ä¼ å…¥çš„DownloadManager.Rquestå¯¹è±¡ï¼Œä¼ å…¥è¯·æ±‚å<br>toContentValues()æ–¹æ³•ä¼šä»¥ä¼ å…¥åŒ…åå°†å¾…æ’å…¥çš„æ•°æ®ç”ŸæˆContentValues,æ–¹æ³•ä¸­ä¼šæœ‰ä¸€ä¸ªæ–­è¨€æ£€æŸ¥ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>ContentValues toContentValues(String packageName) {
    ContentValues values = new ContentValues();
    assert mUri != null;
    //.......
}
</code></pre><p><em>å…¶å®çœ‹åˆ°è¿™å¤„æ–­è¨€æ£€æŸ¥æœ‰ç‚¹ç–‘æƒ‘ï¼Œåœ¨æ„é€ Uriå¯¹è±¡çš„æ—¶å€™å·²ç»è¿›è¡Œäº†ç©ºåˆ¤æ–­ï¼Œä¸ºä»€ä¹ˆæ­¤å¤„è¿˜è¦è¿›è¡Œä¸€æ¬¡æ–­è¨€æ£€æŸ¥å‘¢,ä¸æ˜¯ä¼šæœ‰å†—ä½™å—?</em></p>
<p>åœ¨æ’å…¥ContentValuesæ—¶ï¼ŒmResolver.insert()å®é™…è°ƒç”¨çš„æ˜¯ç³»ç»ŸDownloadProviderä¸­çš„insertæ–¹æ³•,æ’å…¥è¿”å›çš„downloadUriä¼šåœ¨åŸæœ‰UriåŸºç¡€ä¸Šè°ƒç”¨<code>ContentUris.withAppendedId(Downloads.Impl.CONTENT_URI, rowID)</code>æ·»åŠ ä¸€ä¸ªrowIdè¿”å›ä¸€ä¸ªå½¢å¦‚<code>content://downloads/my_downloads/33</code>çš„Uriï¼Œç»è¿‡Uriæˆªå–ä¹‹åï¼Œå®é™…æ“ä½œçš„referenceå…¶å®æ˜¯æ•°æ®åº“ä¸­çš„rowId(æ•°æ®åº“è¡Œå·)ã€‚</p>
<h3 id="DownloadProviderçš„è°ƒç”¨å¤„ç†"><a href="#DownloadProviderçš„è°ƒç”¨å¤„ç†" class="headerlink" title="DownloadProviderçš„è°ƒç”¨å¤„ç†"></a>DownloadProviderçš„è°ƒç”¨å¤„ç†</h3><p>åœ¨ä¹‹å‰ç‰ˆæœ¬ä¸­ï¼ŒDownloadProvideråœ¨æ’å…¥æ•°æ®åï¼Œä¼šç›´æ¥ä»¥context.startServiceçš„æ–¹å¼<br>æ¥å¯åŠ¨DownloadServiceã€‚è¿›è¡Œå¼‚æ­¥ä»»åŠ¡ä¸‹è½½ã€‚è€Œåœ¨Android Nç‰ˆæœ¬ä¸­å¼•å…¥äº†JobScheduleç»„ä»¶æ¥è¿›è¡Œå¼‚æ­¥ä¸‹è½½ä»»åŠ¡çš„å¤„ç†ã€‚<br>åœ¨Android Lç‰ˆæœ¬ä¸­å¼•å…¥çš„JobSchedulerå¯ä»¥æ§åˆ¶è€—ç”µï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒï¼š<a href="http://blog.csdn.net/qq_31726827/article/details/50462025" target="_blank" rel="external">Android JobScheduleå·¥ä½œè°ƒåº¦</a>,<br>å…¶ä¸­DownlaodProviderä¸­çš„insertæ–¹æ³•ä¸­çš„å…³é”®æ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>final long token = Binder.clearCallingIdentity();
try {
  Helpers.scheduleJob(getContext(), rowID);
} finally {
  Binder.restoreCallingIdentity(token);
}
</code></pre><p>å…¶ä¸­Helpers.scheduleJob()æ–¹æ³•ä¸­ä½¿ç”¨rowIdå°†é‚£æ¡ä¸‹è½½ä¿¡æ¯æŸ¥è¯¢å‡ºæ¥ï¼Œç„¶åè°ƒç”¨ç»‘å®šçš„DownloadJobServiceè¿›è¡Œä¸‹è½½ä»»åŠ¡ã€‚å¦‚æœçº¿ç¨‹è°ƒåº¦å¤±è´¥ï¼Œä¼šè¿”å›falseã€‚</p>
<pre><code>public static void scheduleJob(Context context, long downloadId) {
    final boolean scheduled = scheduleJob(context,ã€€DownloadInfo.queryDownloadInfo(context, downloadId));
    if (!scheduled) {
        // If we didn&apos;t schedule a future job, kick off a notification
        // update pass immediately
        getDownloadNotifier(context).update();
    }
}
</code></pre><p>æ­¤æ—¶getDownloadNotifier(context).update()ä¼šå°†éå†å‡ºæ‰€æœ‰æœªåˆ é™¤çš„</p>
<h3 id="DownloadJobServiceè°ƒåº¦æ‰§è¡Œ"><a href="#DownloadJobServiceè°ƒåº¦æ‰§è¡Œ" class="headerlink" title="DownloadJobServiceè°ƒåº¦æ‰§è¡Œ"></a>DownloadJobServiceè°ƒåº¦æ‰§è¡Œ</h3><p>DownloadServiceä¸­è°ƒåº¦çš„çº¿ç¨‹å¼€å§‹ä¸‹è½½ï¼Œåœ¨onStartJobä¸­ç”¨rowIdæŸ¥å‡ºæ¥åï¼Œç›´æ¥å¼€çº¿ç¨‹å¼€å§‹ä¸‹è½½ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>public boolean onStartJob(JobParameters params) {
  final int id = params.getJobId();
  // Spin up thread to handle this download
  final DownloadInfo info = DownloadInfo.queryDownloadInfo(this, id);
  if (info == null) {
      Log.w(TAG, &quot;Odd, no details found for download &quot; + id);
      return false;
    }
    final DownloadThread thread;
    synchronized (mActiveThreads) {
      thread = new DownloadThread(this, params, info);
      mActiveThreads.put(id, thread);
    }
    thread.start();
    return true;
}
</code></pre><h3 id="DownloadJobServiceä¸­çš„æš‚åœã€å–æ¶ˆä¸å®Œæˆ"><a href="#DownloadJobServiceä¸­çš„æš‚åœã€å–æ¶ˆä¸å®Œæˆ" class="headerlink" title="DownloadJobServiceä¸­çš„æš‚åœã€å–æ¶ˆä¸å®Œæˆ"></a>DownloadJobServiceä¸­çš„æš‚åœã€å–æ¶ˆä¸å®Œæˆ</h3><p>DownloadJobServiceä¸­åœ¨çº¿ç¨‹å¼€å¯åï¼Œä¼šåˆ·æ–°å±•ç¤ºç›¸åº”çš„é€šçŸ¥æ ï¼Œé€šè¿‡é€šçŸ¥æ UIä¸­çš„ç›¸åº”æ§åˆ¶ï¼Œå¯ä»¥å®ç°å¯¹äºä¸‹è½½ä»»åŠ¡çš„æ§åˆ¶ã€‚</p>
<ul>
<li><p>åœ¨å¼€å§‹ä¸‹è½½åï¼Œå½“ç‚¹å‡»å–æ¶ˆåï¼Œä¼šå‘é€å¹¿æ’­åˆ°DownlaodReceiver,å½“æ¥å—åˆ°è¿™ä¸ªå¹¿æ’­åï¼Œä¼šè°ƒç”¨DownloadManager.remove(downloadIds)ï¼Œè€ŒDownloadManager.remove()æ–¹æ³•åˆ™ä¼šè°ƒç”¨DownloadProvider.deleteå»åˆ é™¤è®°å½•ä»»åŠ¡ã€‚åŒæ—¶ä¼šä¾æ®rowIdç§»é™¤è¯¥çº¿ç¨‹è°ƒåº¦ã€‚</p>
</li>
<li><p>ä»»åŠ¡å®Œæˆæ—¶ï¼Œä¼šå‘é€ä¸€ä¸ªå¹¿æ’­ï¼Œé€šçŸ¥ä¸‹è½½å®Œæˆï¼Œä½†æ˜¯è¿™é‡Œæ¯”è¾ƒæ„å¤–çš„æ˜¯ï¼Œä¸‹è½½å®Œæˆçš„å¹¿æ’­å‘é€æ˜¯æ”¾åœ¨DownloadInfoä¸­è°ƒç”¨DownloadInfo.sendIntentIfRequested()å‘é€çš„ï¼Œ è€Œä¸æ˜¯åœ¨DownloadThreadä¸­ã€‚</p>
</li>
<li><p>æš‚åœï¼Œæ¯”è¾ƒå¥‡æ€ªçš„æ˜¯ï¼ŒDownloadManagerçš„å¼‚æ­¥ä¸‹è½½çº¿ç¨‹æä¾›äº†æ–­ç‚¹ä¸‹è½½çš„åŠŸèƒ½ï¼Œå†™å…¥æ–‡ä»¶ä¹Ÿä¼šæ£€æŸ¥ä»»åŠ¡çš„ä¸‹è½½çŠ¶æ€æ˜¯ä¸æ˜¯æš‚åœï¼Œä½†æ˜¯ï¼Œå´å¹¶æœªæä¾›æš‚åœä¸‹è½½ä»»åŠ¡çš„APIæ–¹æ³•ï¼ŒåŒæ—¶å®ƒçš„ä¸‹è½½çŠ¶æ€æŸ¥è¯¢çš„æ–¹æ³•ä¹Ÿæ˜¯ç§æœ‰ç±»å‹çš„ã€‚å¦‚æœéœ€è¦æš‚åœä»»åŠ¡å°±éœ€è¦è‡ªå®šä¹‰è‡ªå·±çš„ä¸‹è½½ä»»åŠ¡äº†ã€‚</p>
</li>
</ul>
<h3 id="DownloadThreadä¸­çš„æ–­ç‚¹ä¸‹è½½çš„å®ç°æ–¹æ³•"><a href="#DownloadThreadä¸­çš„æ–­ç‚¹ä¸‹è½½çš„å®ç°æ–¹æ³•" class="headerlink" title="DownloadThreadä¸­çš„æ–­ç‚¹ä¸‹è½½çš„å®ç°æ–¹æ³•"></a>DownloadThreadä¸­çš„æ–­ç‚¹ä¸‹è½½çš„å®ç°æ–¹æ³•</h3><p>å…¶å®åœ¨DownloadThreadä¸­ï¼Œä¸»è¦çš„ä¸‹è½½æ–¹æ³•å°±æ˜¯å°±æ˜¯çº¿ç¨‹ä¸­çš„excuteDownload()æ–¹æ³•ã€‚éƒ¨åˆ†å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>private void executeDownload() throws StopRequestException {
  final boolean resuming = mInfoDelta.mCurrentBytes != 0;
  ...
  int redirectionCount = 0;
  while (redirectionCount++ &lt; Constants.MAX_REDIRECTS) {
      ......
      conn = (HttpURLConnection) mNetwork.openConnection(url);
      addRequestHeaders(conn, resuming);
      final int responseCode = conn.getResponseCode();
      switch (responseCode) {
          case HTTP_OK:
              if (resuming) {
                  throw new StopRequestException(
                          STATUS_CANNOT_RESUME, &quot;Expected partial, but received OK&quot;);
              }
              parseOkHeaders(conn);
              transferData(conn);
              return;
          case HTTP_PARTIAL:
              if (!resuming) {
                  throw new StopRequestException(
                          STATUS_CANNOT_RESUME, &quot;Expected OK, but received partial&quot;);
              }
              transferData(conn);
              return;
          ......
      }
      ......
  }
}
</code></pre><p>åœ¨addRequestHeaders()æ–¹æ³•ä¸­ï¼Œå¦‚æœä»æ•°æ®åº“ä¸­æŸ¥å‡ºçš„æ•°æ®å·²è¯»å–å†™å…¥æ–‡ä»¶çš„å­—èŠ‚æ•°ä¸ä¸º0ï¼Œåˆ™ä¼šåœ¨è¯·æ±‚å¤´å‰æ·»åŠ ä¸€ä¸ªrange<code>conn.addRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + mInfoDelta.mCurrentBytes + &quot;-&quot;);</code>ï¼Œå½“æ·»åŠ ä¸Šæ­¤è¯·æ±‚å¤´åï¼Œå½“æ±‚æ±‚æˆåŠŸåï¼ŒæœåŠ¡å™¨ä¼šè¿”å›HTTP_PARTIAL,å°†æ¥æ”¶åˆ°çš„æ•°æ®é€šè¿‡transferData()æ–¹æ³•å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚åœ¨å†™å…¥æ–‡ä»¶ä¸­æ—¶ï¼ŒDownloadThreadå¼•å…¥äº†android.drm.DrmManagerClientä¸android.drm.DrmOutputStreamï¼Œè¿™ä¸¤ä¸ªåŒ…ä½äºframework/base/core/drmåŒ…ä¸‹ï¼Œéƒ¨åˆ†å¼•ç”¨ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>if (DownloadDrmHelper.isDrmConvertNeeded(mInfoDelta.mMimeType)) {
  drmClient = new DrmManagerClient(mContext);
  out = new DrmOutputStream(drmClient, outPfd, mInfoDelta.mMimeType);
} else {
  out = new ParcelFileDescriptor.AutoCloseOutputStream(outPfd);
}
</code></pre><p><em>å¯¹äºè¿™ä¸¤ä¸ªç±»çš„å¼•å…¥ï¼Œç›®å‰è¿˜ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œåç»­ç ”ç©¶åä¼šè¿›ä¸€æ­¥è¿›è¡Œåˆ†æ</em></p>
<p>æœ€åä¸§å¿ƒç—…ç‹‚çš„è‡ªå·±ç”»ä¸ªå›¾ï¼Œç®€å•æ€»ç»“ä¸‹DownloadManagerçš„å·¥ä½œæµç¨‹:æ•´ä½“å¤–æºåº”ç”¨å±‚é€šè¿‡FrameWorkå±‚DownloadManager APIè°ƒç”¨åˆ°DownloadProvider,é€šè¿‡æ“ä½œæ•°æ®åº“ï¼Œæœ€åé€šè¿‡DownloadServiceä¸­çš„çº¿ç¨‹è°ƒåº¦å®Œæˆå·¥ä½œã€‚æ•´ä½“ä¸Šéƒ½æ˜¯ç”±DownloadProviderè¿›è¡Œè¿‡æ¸¡è°ƒç”¨ã€‚è€Œæ•°æ®åº“ä¸Serviceéƒ½é€šè¿‡DownloadProviderè¿›è¡Œéš”ç¦»ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1489253-eb335cfacbcd097b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç®€å•ç»“æ„å›¾"></p>
<blockquote>
<p>DownloadManagerä¸­çš„åˆ†æç›®å‰å°±å…ˆå‘Šä¸€æ®µè½ï¼Œæ–‡ä¸­å¦‚æœ‰åˆ†æé”™è¯¯æˆ–æè¿°ä¸æ¸…æ¥šä¹‹å¤„ï¼Œè¯·å¤§å®¶ç•™è¨€æŒ‡å‡ºï½:ï¼‰</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wizardiy.com/2016/08/23/GitæœåŠ¡å™¨æ­å»ºä¸Pythonå»ºç«™ç¯å¢ƒæ­å»º/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="å¯’çŸ³">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://orxuxhbm0.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wizardiy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/23/GitæœåŠ¡å™¨æ­å»ºä¸Pythonå»ºç«™ç¯å¢ƒæ­å»º/" itemprop="url">Git æœåŠ¡å™¨æ­å»ºä¸ Python å»ºç«™ç¯å¢ƒæ­å»º</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-08-23T23:47:56+08:00">
                2016-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/å·¥ä½œæ€»ç»“/" itemprop="url" rel="index">
                    <span itemprop="name">å·¥ä½œæ€»ç»“</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ­å»ºç¯å¢ƒä¸ºé˜¿é‡Œäº‘ CenterOS 7.0 64ä½,<br>GitæœåŠ¡å™¨è‡ªå¸¦ç‰ˆæœ¬å·ä¸º 1.8.3.1</p>
<h3 id="GitæœåŠ¡å™¨æ­å»ºä¸é…ç½®"><a href="#GitæœåŠ¡å™¨æ­å»ºä¸é…ç½®" class="headerlink" title="GitæœåŠ¡å™¨æ­å»ºä¸é…ç½®"></a>GitæœåŠ¡å™¨æ­å»ºä¸é…ç½®</h3><ol>
<li>åˆ›å»ºGitç®¡ç†å‘˜è´¦å·å¹¶è®¾ç½®å¯†ç ï¼š<br><code>useradd -m git</code><br><code>passwd git</code><br><em>æ‰§è¡Œæ­¤æ­¥æ“ä½œåï¼Œç³»ç»Ÿä¼šåœ¨ä¼šåœ¨/Home/ä¸‹åˆ›å»ºä¸€ä¸ªä»¥ç”¨æˆ·åå‘½åçš„æ–‡ä»¶å¤¹</em><br><em>åˆ é™¤ç”¨æˆ·çš„å‘½ä»¤ä¸º<code>userdel username</code></em><br><em>åˆ é™¤ç»„çš„å‘½ä»¤ä¸º<code>groupdel groupname</code></em></li>
<li>å¯¼å…¥å®¢æˆ·ç«¯ç”Ÿæˆçš„SSHå…¬é’¥æ–‡ä»¶ï¼š<br>æœåŠ¡ç«¯åœ¨/Home/gitç›®å½•ä¸‹åˆ›å»º.sshæ–‡ä»¶å¤¹ï¼Œåˆ›å»ºå‡ºæ¥çš„æ–‡ä»¶å¤¹æ˜¯éšè—æ–‡ä»¶ï¼Œæ³¨æ„ä½¿ç”¨lså‘½ä»¤æ˜¯æ— æ³•æŸ¥çœ‹çš„ï¼Œåœ¨.sshæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºauthorized_keysæ–‡ä»¶ï¼Œå°†å®¢æˆ·ç«¯ç”Ÿæˆçš„å…¬é’¥æ–‡ä»¶(.pubæ–‡ä»¶)å†…å®¹å¯¼å…¥æ–‡ä»¶ä¸­ã€‚<br><em>å®¢æˆ·ç«¯ç”ŸæˆSSHå…¬é’¥æ–¹æ³•è¯·å‚è€ƒ<a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/" target="_blank" rel="external">Generating a new SSH key and adding it to the ssh-agent</a></em><br><em>å®¢æˆ·ç«¯å¦‚æœç”Ÿæˆæœ‰å¤šä¸ªSSH Key, è¯·æœ¬åœ°é…ç½®configæ–‡ä»¶</em></li>
<li>ç¦æ­¢gitè´¦å·çš„SSHç™»å½•ï¼š<br>ä¿®æ”¹ /etc/passwd æ–‡ä»¶ä¸­gitè´¦å·çš„é…ç½®ã€‚å¦‚æœæœ‰ /bin/bash ä¿®æ”¹ä¸º /usr/bin/git-shellï¼Œå¦åˆ™å¢åŠ æ­¤é…ç½®ã€‚</li>
<li>ä¿®æ”¹SSHè®¤è¯é…ç½®æ–‡ä»¶:<br>å‘½ä»¤è¡Œä¸­æ‰§è¡Œ<code>vi /etc/ssh/sshd_config</code>ï¼Œå°†é…ç½®æ–‡ä»¶ä¸­çš„<br><code>RSAAuthentication yes</code><br><code>PubkeyAuthentication yes</code><br>è¿™ä¸¤ä¸ªé€‰é¡¹çš„æ³¨é‡Šæ‰“å¼€ã€‚</li>
<li>åˆå§‹åŒ–Gitä»“åº“ï¼š<br>åœ¨/home/git/ç›®å½•ä¸‹åˆ›å»ºrepositoriesç›®å½•ï¼ŒåŒæ—¶ä¿®æ”¹æƒé™ã€‚<br><code>sudo mkdir /home/git/repositories</code><br><code>sudo chown git:git /home/git/repositories</code><br><code>chmod 700 /home/git/repositories</code><br>åœ¨repositoriesç›®å½•åˆ›å»ºgitä»“åº“ï¼Œå¹¶åŒæ—¶åˆå§‹åŒ–ã€‚<br><code>cd /home/git/repositories/</code><br><code>mkdir mytest.git</code><br><code>sudo chown git:git mytest.git/</code><br><code>cd mytest.git/</code><br><code>git init --bare</code><br>è‡³æ­¤ï¼Œæ•´ä¸ªGitæœåŠ¡å™¨æ­å»ºå·¥ä½œå®Œæˆã€‚</li>
<li>è‹¥å¹²å¯èƒ½é‡åˆ°çš„é—®é¢˜è¯´æ˜ï¼š<ul>
<li>ä½¿ç”¨SSHç™»å½•å¦‚æœæç¤ºæ­¤å¼‚å¸¸ï¼šfatal: Interactive git shell is not enabled. hint: ~/git-shell-commands should exist and have read and execute access.<br>è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š<br><code>cp /usr/share/doc/git/contrib/git-shell-commands /home/git -R</code><br><code>chown git:git /home/git/git-shell-commands/ -R</code></li>
<li>å¦‚æœä½¿ç”¨SSHç™»å½•è¿›å…¥ï¼Œæ˜¾ç¤ºç»“æœä¸ºï¼šRun â€˜helpâ€™ for help, or â€˜exitâ€™ to leave.  Available commands:<br>list<br><a href="https://git-scm.com/docs/git-shell" target="_blank" rel="external">å‚è€ƒæ–‡æ¡£</a>è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š<br>åŸºäºä¸Šä¸€æ­¥æ“ä½œï¼Œ<br><code>vi /home/git/git-shell-commands/no-interactive-login</code><br><code>cat &gt;/home/git/git-shell-commands/no-interactive-login &lt;&lt;\EOF</code><br>è¾“å…¥ï¼š<code>printf &#39;%s\n&#39; &quot;Hi $USER! You&#39;ve successfully authenticated, but I do not&quot;</code><br>è¾“å…¥ï¼š<code>printf &#39;%s\n&#39; &quot;provide interactive shell access.&quot;</code><br>è¾“å…¥ï¼š<code>exit 128</code><br><code>EOF</code><br><code>chmod +x /home/git/git-shell-commands/no-interactive-login</code></li>
<li>å¦‚æœåœ¨åˆ›å»ºä»“åº“åï¼Œå‘ç°å®¢æˆ·ç«¯æäº¤å¼‚å¸¸ï¼šremote: error: insufficient permission for adding an object to repository database ./objects<br>remote: fatal: failed to write object<br>error: unpack failed: unpack-objects abnormal exit<br>è¯·ä¿®æ”¹ä»“åº“è¯»å†™æƒé™å¦‚ä¸‹ï¼š<br><code>sudo chown -R git:git mytest.git</code></li>
<li>å¦‚æœç¬¬ä¸€æ¬¡æäº¤æ—¶æç¤ºå¼‚å¸¸ï¼šNo refs in common and none specified; doing nothing.<br>Perhaps you should specify a branch such as â€˜masterâ€™.<br>è¯·ä½¿ç”¨å¦‚ä¸‹çš„æäº¤å‘½ä»¤ï¼š<br><code>git push --set-upstream origin master</code></li>
</ul>
</li>
</ol>
<hr>
<h3 id="Nginxå®‰è£…ï¼š"><a href="#Nginxå®‰è£…ï¼š" class="headerlink" title="Nginxå®‰è£…ï¼š"></a>Nginxå®‰è£…ï¼š</h3><ol>
<li>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„nginxåŒ…<br><code># wget http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</code></li>
<li>å»ºç«‹nginxçš„yumä»“åº“<br><code># rpm -ivh nginx-release-centos-7-0.el7.ngx.noarch.rpm</code></li>
<li>ä¸‹è½½å¹¶å®‰è£…nginx<br><code># yum install nginx</code></li>
<li>å¯åŠ¨nginxæœåŠ¡<br><code>systemctl start nginx</code></li>
<li>æµ‹è¯•<br>åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥éƒ¨ç½²nginxç¯å¢ƒçš„æœºå™¨çš„IPï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåº”è¯¥èƒ½çœ‹åˆ°â€Welcome to nginx!â€å­—æ ·çš„å†…å®¹ã€‚</li>
</ol>
<h3 id="Django-å®‰è£…"><a href="#Django-å®‰è£…" class="headerlink" title="Django å®‰è£…"></a>Django å®‰è£…</h3><ol>
<li>é¦–å…ˆå®‰è£…pipåŒ…ç®¡ç†å·¥å…·ï¼š<br><code>wget https://bootstrap.pypa.io/get-pip.py</code><br><code>python get-pip.py</code></li>
<li>ä½¿ç”¨pipå®‰è£…django:<br><code>pip install djangoï¼ï¼1.7</code></li>
<li>å®‰è£…åæ£€æµ‹æ˜¯å¦å®‰è£…å®Œæˆï¼š<br><code>python</code><br><code>python install djangoï½€</code>django.get_version()ï½€<br>è¾“å‡º1.7ï¼Œè¯æ˜å®‰è£…æˆåŠŸã€‚</li>
</ol>
<h3 id="GUnicornå®‰è£…"><a href="#GUnicornå®‰è£…" class="headerlink" title="GUnicornå®‰è£…"></a>GUnicornå®‰è£…</h3><p><a href="http://docs.gunicorn.org/en/latest/install.html" target="_blank" rel="external">å‚è€ƒæ–‡æ¡£</a>ä½¿ç”¨<code>pip install unicorn</code>,å…¨éƒ¨å®‰è£…å®Œæˆ</p>
<h3 id="MySQLå®‰è£…ï¼š"><a href="#MySQLå®‰è£…ï¼š" class="headerlink" title="MySQLå®‰è£…ï¼š"></a>MySQLå®‰è£…ï¼š</h3><p>åœ¨CenterOS 7.0ä¸­çš„yumæºæ²¡æœ‰mysql-server,æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨å¦‚ä¸‹æ–¹å¼å®‰è£…ï¼š<br><code># wget http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</code><br><code># rpm -ivh mysql-community-release-el7-5.noarch.rpm</code><br><code># yum install mysql-community-server</code><br>æˆåŠŸå®‰è£…ä¹‹åé‡å¯mysqlæœåŠ¡<br><code># service mysqld restart</code></p>
<h3 id="MySQLdb-æ¨¡å—ä¾èµ–å®‰è£…ï¼š"><a href="#MySQLdb-æ¨¡å—ä¾èµ–å®‰è£…ï¼š" class="headerlink" title="MySQLdb æ¨¡å—ä¾èµ–å®‰è£…ï¼š"></a>MySQLdb æ¨¡å—ä¾èµ–å®‰è£…ï¼š</h3><p>ç›´æ¥å°è¯•è¿è¡Œpythoné¡¹ç›®æŠ¥é”™ç¼ºå°‘MySQLdbï¼Œä½¿ç”¨yumå®‰è£…<br><code>yum install MySQL-python -y</code><br><em>å°è¯•ä½¿ç”¨pipå®‰è£…ï¼Œä½†æ˜¯å®‰è£…å¤±è´¥ã€‚å¦‚æœæœ‰æˆåŠŸçš„åŒå­¦æ¬¢è¿åˆ†äº«ç»éªŒã€‚</em></p>
<p><em>PS:æ˜¨å¤©æœåŠ¡å™¨åˆšåˆšæ­å¥½ï¼Œä»Šå¤©é˜¿é‡Œäº‘å°±æŠ¥è­¦è¯´æœåŠ¡å™¨è¢«é»‘äº†ï¼Œçœ‹åå°æ˜¯ç”¨gitç”¨æˆ·ç™»å½•çš„ã€‚åŸæ¥gité…ç½®æ—¶è€ƒè™‘æ–‡ä»¶æƒé™è¯»å–ï¼Œæœ¬æ¥è¿˜æŠŠgitç”¨æˆ·sudoersæ–‡ä»¶ä¸­çš„ã€‚åæ¥æ ¼å®Œç›˜è€ƒè™‘åˆ°å®‰å…¨æ€§å°±æ²¡åœ¨åŠ äº†ã€‚é™„ä¸Šæ“ä½œï¼š<br><code>visudo</code>åœ¨<code>root ALL=(ALL)ALL</code>ä¸‹é¢ä¸€è¡Œæ·»åŠ  <code>git ALL=(ALL)ALL</code></em></p>
<blockquote>
<p>å¦‚æœæœ‰å»ºç«™ç»éªŒä¸°å¯Œçš„åŒå­¦ï¼Œæ¬¢è¿ç ¸ç –ç•™è¨€æŒ‡å¯¼ï¼šï¼‰</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wizardiy.com/2016/08/18/Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸‰ï¼‰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="å¯’çŸ³">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://orxuxhbm0.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wizardiy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/18/Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸‰ï¼‰/" itemprop="url">Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸‰ï¼‰</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-08-18T19:34:56+08:00">
                2016-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æºç åˆ†æ/" itemprop="url" rel="index">
                    <span itemprop="name">æºç åˆ†æ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åœ¨å‰é¢ä¸¤ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ä»‹ç»äº† Hanlder çš„æ„é€ æ–¹æ³•ä¸ Looper çš„åˆå§‹åŒ–ã€‚æœ¬ç¯‡ä¸­æˆ‘ä»¬å°†å¯¹ä¸»çº¿ç¨‹ Looper ä¸ Handler æ¶ˆæ¯å¾ªç¯çš„å·¥ä½œæ–¹å¼è¿›è¡Œåˆ†æã€‚</p>
<p><em>å‰æ–‡é“¾æ¥å¦‚ä¸‹æ‰€ç¤º</em></p>
<ul>
<li><a href="http://wizardiy.com/2016/06/17/Handler%20%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89/">ã€ŠHandler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸€ï¼‰ã€‹</a></li>
<li><a href="http://wizardiy.com/2016/06/18/Handler%20%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89/">ã€ŠHandler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆäºŒï¼‰ã€‹</a></li>
</ul>
<h3 id="ä¸»çº¿ç¨‹çš„Looperåˆå§‹åŒ–"><a href="#ä¸»çº¿ç¨‹çš„Looperåˆå§‹åŒ–" class="headerlink" title="ä¸»çº¿ç¨‹çš„Looperåˆå§‹åŒ–"></a>ä¸»çº¿ç¨‹çš„Looperåˆå§‹åŒ–</h3><p>ä¸»çº¿ç¨‹çš„ looper çš„åˆå§‹åŒ–æ˜¯åœ¨ Looper.prepareMainLooper ä¸­è¿›è¡Œåˆå§‹åŒ–çš„ã€‚è€Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨ä½ç½®åœ¨ ActivityThread ä¸­ main æ–¹æ³•ä¸­å…¶ä»£ç å¼•ç”¨å¦‚ä¸‹ï¼š</p>
<pre><code>Looper.prepareMainLopper();
ActivityThread thread = new ActivityThread();
thread.attach(false);
if (false) {
    Looper.myLooper().setMessag
}
Looper.loop();
</code></pre><p>è€Œ ActivityThread çš„ main æ–¹æ³•æ˜¯ Android åº”ç”¨ç¨‹åºä¸»çº¿ç¨‹çš„å…¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼šä¸»çº¿ç¨‹çš„ Looper åœ¨åº”ç”¨å¯åŠ¨æ—¶å·²ç»åˆå§‹åŒ–è¿‡äº†ã€‚</p>
<h3 id="Handler-çš„æ¶ˆæ¯å‘é€"><a href="#Handler-çš„æ¶ˆæ¯å‘é€" class="headerlink" title="Handler çš„æ¶ˆæ¯å‘é€"></a>Handler çš„æ¶ˆæ¯å‘é€</h3><p>æˆ‘ä»¬åœ¨åˆ›å»ºå¥½ ï¼¨andler åï¼Œä½¿ç”¨ Handler å‘é€æ¶ˆæ¯ä¸€èˆ¬è°ƒç”¨æ ¹æ®å…¶æ–¹æ³•è°ƒç”¨æœ‰:</p>
<ul>
<li>sendMessage()</li>
<li>sendEmptyMessage()</li>
<li>sendMessageAtTime()</li>
<li>sendMessageDelayed()</li>
</ul>
<p>å…¶ä¸­ä¸»è¦åŒºåˆ«åœ¨äºå¦‚ä¸‹æºç å±•ç¤º:</p>
<pre><code>public final boolean sendMessage(Message msg) {
    return sendMessageDelayed(msg, 0);
}

public final boolean sendEmptyMessage(int what) {
    return sendEmptyMessageDelayed(what, 0);
}

public final boolean sendMessageDelayed(Message msg, long delayMillis) {
    if (delayMillis &lt; 0) {
        delayMillis = 0;
    }
    return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);
}

public final boolean sendEmptyMessageDelayed(int what, long delayMillis) {
    Message msg = Message.obtain();
    msg.what = what;
    return sendMessageDelayed(msg, delayMillis);
}


public boolean sendMessageAtTime(Message msg, long uptimeMillis) {
    MessageQueue queue = mQueue;
    if (queue == null) {
        RuntimeException e = new RuntimeException(
                this + &quot; sendMessageAtTime() called with no mQueue&quot;);
        Log.w(&quot;Looper&quot;, e.getMessage(), e);
        return false;
    }
    return enqueueMessage(queue, msg, uptimeMillis);
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å‘é€ EmptyMessage æ—¶ï¼Œä¼šåœ¨ Handler ä¸­ä½¿ç”¨ Message.obtain() æ¥æ„é€ ä¸€ä¸ª Message ï¼Œè€Œå¦‚æœå‘é€æ— å»¶æ—¶æ¶ˆæ¯æ—¶ï¼Œä¼šè®¾ç½®å»¶æ—¶æ—¶é—´ä¸º0ï¼Œæœ€åä¼šå‘é€éƒ½ä¼šè°ƒç”¨ sendMessageAtTime() æ–¹æ³•ã€‚æ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šé€šè¿‡ enqueMessage å‘é€å‡ºå»ã€‚</p>
<p><em>æ³¨æ„ï¼š Hanlder ä¸­çš„ enqueMessage ä¸­ä¼šè°ƒç”¨å…¶ä¸­ messageQueue.enqueMessage(msg, uptimeMillis) ,ä½†æ˜¯ Handler ä¸­çš„ MessageQueue å¯¹è±¡æ˜¯ä» Looper ä¸­ get åˆ°çš„ï¼Œæ‰€ä»¥ï¼ŒMessageQueue è€¦åˆçš„è¿˜æ˜¯ Looper</em></p>
<h3 id="MessageQueue-çš„æ¶ˆæ¯éå†"><a href="#MessageQueue-çš„æ¶ˆæ¯éå†" class="headerlink" title="MessageQueue çš„æ¶ˆæ¯éå†"></a>MessageQueue çš„æ¶ˆæ¯éå†</h3><pre><code>if (p == null || when == 0 || when &lt; p.when) {
    // New head, wake up the event queue if blocked.
    msg.next = p;
    mMessages = msg;
    needWake = mBlocked;
} else {
    // Inserted within the middle of the queue.  Usually we don&apos;t have to wake
    // up the event queue unless there is a barrier at the head of the queue
    // and the message is the earliest asynchronous message in the queue.
    needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous();
    Message prev;
    for (;;) {
        prev = p;
        p = p.next;
        if (p == null || when &lt; p.when) {
            break;
        }
        if (needWake &amp;&amp; p.isAsynchronous()) {
            needWake = false;
        }
    }
    msg.next = p; // invariant: p == prev.next
    prev.next = msg;
}
if (needWake) {
    nativeWake(mPtr);
}
</code></pre><p>å¦‚ä¸Šå›¾ä¸­ä»£ç ä¸­æ‰€ç¤ºï¼šå…¶ä¸­ä¸»è¦æ“ä½œæ˜¯å°†æ–°åŠ å…¥çš„ Message ä¸å½“å‰çš„ MessageQueue ä¸­çš„å¤´è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå½“å‰æœ‰æ–°æ¶ˆæ¯è¿›å…¥å¹¶ä¸”è§¦å‘æ—¶é—´ä¸º0æˆ–å°äºå½“å‰å¤´èŠ‚ç‚¹çš„æ—¶é—´ï¼Œå¦‚æœé˜Ÿåˆ—é˜»å¡ï¼Œåˆ™å”¤é†’çº¿ç¨‹å¤„ç†ã€‚å¦‚æœæ–°æ¶ˆæ¯è§¦å‘æ—¶é—´é•¿äºé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ—¶é—´ï¼Œåˆ™æŒ‰æ—¶é—´æ’åºï¼Œæ’å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚å¦‚æœå”¤é†’çº¿ç¨‹ï¼Œåˆ™è°ƒç”¨ nativeWake å‡½æ•°è¿›è¡Œ JNI æ–¹æ³•è°ƒç”¨å‘é€æ¶ˆæ¯ã€‚</p>
<h3 id="æ¶ˆæ¯å¾ªç¯å¤„ç†ä¸å›è°ƒ"><a href="#æ¶ˆæ¯å¾ªç¯å¤„ç†ä¸å›è°ƒ" class="headerlink" title="æ¶ˆæ¯å¾ªç¯å¤„ç†ä¸å›è°ƒ"></a>æ¶ˆæ¯å¾ªç¯å¤„ç†ä¸å›è°ƒ</h3><p>Looper ä¸­çš„ loop() æ–¹æ³•ä¼šæ‹¿åˆ°ä¸ looper è€¦åˆçš„ MessageQueue å¯¹è±¡ï¼Œç”± MessageQueue è°ƒç”¨ next() æ–¹æ³•ï¼Œå¦‚æœ meesage å¯¹è±¡ä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨ msg.target.dispatchMessage(msg) å›è°ƒåˆ° Handler ä¸­ã€‚</p>
<pre><code>public void dispatchMessage(Message msg) {
    if (msg.callback != null) {
        handleCallback(msg);
    } else {
        if (mCallback != null) {
            if (mCallback.handleMessage(msg)) {
                return;
            }
        }
        handleMessage(msg);
    }
}
</code></pre><p>å…¶ä¸­ï¼Œelse è¯­å¥ä¸­çš„ handlerMessage æœ€ç»ˆä¼šå›è°ƒå›å½“æ—¶åˆ›å»ºçš„ Handler å¯¹åº”çš„ handMessage æ–¹æ³•ä¸­ã€‚</p>
<p><em>åœ¨å›è°ƒä¸­ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°é™¤äº† handleMessage çš„å›è°ƒï¼Œè¿˜æœ‰å¯ä»¥æ³¨å†Œ message çš„ CallBack æˆ–è€… Handlerçš„ callback æ¥å›è°ƒã€‚message çš„ Callback éœ€è¦åœ¨ message åˆ›å»ºæ—¶ä¼ å…¥ä¸€ä¸ª Runnable å¯¹è±¡ã€‚è€Œ Handlerçš„ Callback ä¸ handleMessage æ–¹æ³•å°±ç›®å‰è€Œè¨€ä½¿ç”¨ä¸Šæ²¡æ„Ÿè§‰æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚<br>å¸Œæœ›æœ‰äº†è§£çš„åŒå­¦èƒ½å¯¹è¿™ä¸ªé—®é¢˜ç•™è¨€è¯´æ˜ä¸‹ï¼Œè°¢è°¢ï½ï¼</em></p>
<h5 id="å†™åˆ°æœ€å"><a href="#å†™åˆ°æœ€å" class="headerlink" title="å†™åˆ°æœ€å"></a>å†™åˆ°æœ€å</h5><blockquote>
<p>Handlerçš„åŸºç¡€åˆ†æå°±ç®—å®Œæˆäº†ï¼Œåç»­æœ‰æ—¶é—´ä¼šåšå…¶ä»–ç›¸å…³çš„æºç åˆ†æã€‚<br>ä¸è¶³ä¹‹å¤„ï¼Œè¯·å¤§å®¶æ‰¹è¯„æŒ‡å¯¼ã€‚</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wizardiy.com/2016/06/18/Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆäºŒï¼‰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="å¯’çŸ³">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://orxuxhbm0.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wizardiy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/18/Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆäºŒï¼‰/" itemprop="url">Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆäºŒï¼‰</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-06-18T17:16:56+08:00">
                2016-06-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æºç åˆ†æ/" itemprop="url" rel="index">
                    <span itemprop="name">æºç åˆ†æ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>åœ¨ä¸Šä¸€ç‰‡æ–‡ç« ä¸­<a href="http://wizardiy.com/2016/06/17/Handler%20%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89/">Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸€ï¼‰</a>ä¸­æˆ‘ä»¬åˆ†æåˆ°Handleråœ¨åˆ›å»ºæ—¶ä¼šç»‘å®šä¸€ä¸ª Looper å¯¹è±¡ï¼Œè€ŒLooper å¦‚æœç”¨æˆ·ä¸è¿›è¡Œæ˜¾å¼ä¼ å…¥ï¼Œä¼šåœ¨ Handler ä¸­è°ƒç”¨ Looper.myLooper() æ¥åˆ›å»ºä¸€ä¸ª Looper å¯¹è±¡ã€‚</p>
<p>é‚£ä»€ä¹ˆæ˜¯ Looper å‘¢ï¼Ÿ Android ä¸­å¯¹äº Looper ç±»çš„æ³¨é‡Šä¸­æ˜¯è¿™æ ·æè¿°çš„ï¼šâ€œClass used to run a message loop for a threadâ€ã€‚å¤§æ¦‚æ„æ€æ˜¯æŒ‡è¿™ä¸ªç±»æ˜¯ç”¨æ¥ä¸ºä¸€ä¸ªçº¿ç¨‹åšæ¶ˆæ¯å¾ªç¯ã€‚è€Œ Looper ç±»æœ¬èº«è¢«å£°æ˜ä¸º final ç±»å‹çš„ï¼ŒåŒæ—¶å®ƒçš„æ„é€ æ–¹æ³•ä¹Ÿè¢«å£°æ˜ä¸º final ç±»å‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœè¦è·å–å…¶ä¸­çš„ Looper å®ä¾‹æˆ–è€…ä½¿ç”¨ Looper çš„æ–¹æ³•éœ€è¦ä½¿ç”¨å…¶ä¸­æä¾›çš„ä¸¤ç§é™æ€æ–¹æ³•ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1489253-6a6158c9a3c87f21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ getMainLooper() æ–¹æ³•è¿˜æ˜¯ myLooper() æ–¹æ³•ï¼Œè·å–çš„ Looper éƒ½æ˜¯ç›´æ¥è¿”å›å·²ç»åˆå§‹åŒ–çš„å¯¹è±¡ã€‚é‚£å®ƒä»¬çš„åˆå§‹åŒ–åœ¨å“ªæ“ä½œçš„å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1489253-15a623d946d67366.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸»çº¿ç¨‹ Looper å’Œå­çº¿ç¨‹ Looper åˆ›å»ºçš„åŒºåˆ«åœ¨äºä¸€ä¸ª quitAllowed å˜é‡ï¼ˆä¸»çº¿ç¨‹ä¸º false , å­çº¿ç¨‹ä¸º true ï¼‰ã€‚è€Œæœ€ç»ˆè¿™ä¸ªå˜é‡ä¼šä¼ å…¥åˆ° Looper æ„é€ æ–¹æ³•ä¸­ç”¨äºæ„é€  MessageQueue ã€‚è€Œ Looper ä¸­çš„çº¿ç¨‹ç»‘å®šçš„æ˜¯å½“å‰çº¿ç¨‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1489253-8846ed6a2eeca544.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>è¿™æ ·çš„è¯ï¼Œç»“åˆä¸Šä¸€ç¯‡ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç›´æ¥åœ¨å­çº¿ç¨‹ä¸­ä½¿ç”¨ Handler handler = new Handler(),ä¼šè°ƒç”¨ Looper.myLooper() æ–¹æ³•è·å– Looper å¯¹è±¡ï¼Œåœ¨è¿™ä¹‹å‰å¹¶æ²¡æœ‰è°ƒç”¨ Looper.prepare() æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥ sThreadLocal.get() ä¸­ä¼šè¿”å› null ï¼Œè¿›è€ŒæŠ¥é”™ã€‚</p>
<p>é‚£å¤§å®¶æˆ–è®¸ä¼šé—®ï¼Œä¸»çº¿ç¨‹ä¸­çš„ mainLooper æ˜¯ä½•æ—¶è¿›è¡Œåˆå§‹åŒ–çš„å‘¢ï¼Œä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¸­ç›´æ¥ new Handler() ä¸ä¼šæŠ¥é”™å‘¢ï¼Ÿå…¶å®è¿™ä¸ªä¸»çº¿ç¨‹ Handler åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±å·²ç»è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œå…·ä½“å¯åŠ¨æ—¶æœºéœ€è¦åœ¨åé¢ç»§ç»­åˆ†æå‘¢ï½ğŸ˜Š</p>
<p>ï¼Špsï¼šåç»­æ–‡ç« ä¼ é€é—¨ï¼šï¼Š</p>
<ul>
<li><a href="http://wizardiy.com/2016/08/18/Handler%20%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89/">Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸‰ï¼‰</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wizardiy.com/2016/06/17/Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸€ï¼‰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="å¯’çŸ³">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://orxuxhbm0.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wizardiy">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/06/17/Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸€ï¼‰/" itemprop="url">Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸€ï¼‰</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-06-17T18:56:56+08:00">
                2016-06-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æºç åˆ†æ/" itemprop="url" rel="index">
                    <span itemprop="name">æºç åˆ†æ</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¸€ç›´åœ¨ç”¨ Handler,ä½†å´ä¸€ç›´å› ä¸ºä¸èƒ½å‡†ç¡®è¡¨è¿°å…¶å·¥ä½œåŸç†è€Œè€¿è€¿äºæ€€ï¼Œç°åœ¨æ­£å¥½æœ‰æ—¶é—´ï¼Œè‡ªå·±å†³å®šåˆæ­¥æ¢³ç†ä¸‹ã€‚å¦‚æœæœ‰æ•´ç†ä¸è¶³æˆ–ä¸å‡†ç¡®çš„åœ°æ–¹ï¼Œè¯·å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚</p>
<p>ç›¸ä¿¡å¤§å®¶å¯¹äºä¸»çº¿ç¨‹ä¸­åˆ›å»ºå¹¶ä½¿ç”¨ Handler ä¸€ç‚¹éƒ½ä¸é™Œç”Ÿäº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆå£°æ˜ä¸º static çš„é™æ€ç±»åŸå› æ˜¯é¿å… Handler ä½œä¸ºå†…éƒ¨ç±»ï¼Œé¿å…éšå¼æŒæœ‰å¤–éƒ¨å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚ï¼‰</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1489253-325849abb2712457.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>æˆ–è®¸å¤§å®¶ä¹Ÿæœ‰ç¢°åˆ°è¿‡ç±»ä¼¼äºä¸‹é¢çš„å£°æ˜æ–¹æ³•:</p>
<ul>
<li>Handler mainHandler = newHandler(Looper.getMainLooper());<p></p></li>
</ul>
<p>ä½†æ˜¯é˜…è¯» Handler æºç å‘ç°ï¼ŒHandler æä¾›äº†å¤šç§æ„é€ æ–¹æ³•ä»¥ä¾›ä½¿ç”¨:</p>
<ol>
<li>public Handler() { this(null,false); }</li>
<li>public Handler(Callback callback) { this(callback,false); }</li>
<li>public Handler(Looper looper) { this(looper,null,false); }</li>
<li>public Handler(Looper looper, Callback callback) { this(looper, callback,false);}</li>
<li>public Handler(boolean async) {this(null, async);}</li>
<li>public Handler(Callback callback, boolean async) {}</li>
<li>public Handler(Looper looper, Callback callback,booleanasync) {}</li>
</ol>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæœªä¼ å…¥æœ€å¸¸è§çš„å‚æ•°ä¸ºç©ºçš„æ„é€ æ–¹æ³•å…¶å®å¼•ç”¨çš„åºå·ä¸º6çš„æ„é€ æ–¹æ³•ã€‚å…¶å®å¤§å®¶åº”è¯¥ä¹Ÿæœ‰å‘ç°ï¼šHandler å¦‚æœä¸æ˜¾å¼ä¼ å…¥ Looper åˆ›å»ºå¯¹è±¡çš„è¯ï¼Œæœ€åéƒ½ä¼šè°ƒç”¨åºå·ä¸º6çš„æ„é€ æ–¹æ³•ï¼Œè€Œå¦‚æœæ˜¾ç¤ºä¼ å…¥ Looper çš„è¯ï¼Œæœ€åéƒ½ä¼šè°ƒç”¨åºå·ä¸º7çš„æ„é€ æ–¹æ³•ã€‚</p>
<p>è€Œæ„é€ æ–¹æ³•6ä¸æ„é€ æ–¹æ³•7çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé™„ä¸Šæºç å¤§å®¶åº”è¯¥å°±æ¯”è¾ƒæ¸…æ¥šäº†</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1489253-bcbc1d99a5675e43.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå”¯ä¸€çš„åŒºåˆ«æˆ–è®¸å°±æ˜¯mLooperçš„è·å–æ–¹å¼äº†ï¼Œè€Œåœ¨æ„é€ æ–¹æ³•6ä¸­ï¼Œ å¦‚æœmLooperå¯¹è±¡ä¸ºç©ºçš„æ—¶å€™ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œç§°åœ¨çº¿ç¨‹ä¸­åˆ›å»ºhandleræ—¶æ²¡ç”¨è°ƒç”¨Looper.prepare()æ–¹æ³•ã€‚æˆ‘æƒ³è¿™ä¹Ÿè®¸å°±æ˜¯å¤§å¤šæ•°æ—¶å€™åœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨æ„é€ æ–¹æ³•1ï¼Œæ—¶ä¼šæŠ›å‡ºå¼‚å¸¸çš„åŸå› äº†ã€‚</p><p>è‡³äºä¸ºä½•ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¯·æœŸå¾…å¯¹Looperç±»çš„åˆ†æå§ï½ï½ï½ğŸ˜Š</p>
<p><em>psï¼šæˆ–è®¸æœ‰å“ªä½å°ä¼™ä¼´èƒ½å›ç­”ä¸‹FIND_POTENTIAL_LEAKSè¿™ä¸ªå‚æ•°æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ</em></p>
<p>ç›¸å…³æ–‡ç« é“¾æ¥ï¼š</p>
<ul>
<li><a href="">Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æ(äºŒ)</a></li>
<li><a href="">Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æ(ä¸‰)</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://orxuxhbm0.bkt.clouddn.com/avatar.jpg"
               alt="å¯’çŸ³" />
          <p class="site-author-name" itemprop="name">å¯’çŸ³</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/rayGuoRay" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:guolei_ray@yeah.net" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-envelope-o"></i>
                  
                  Email
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/e80ee485cfce" target="_blank" title="ç®€ä¹¦">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  ç®€ä¹¦
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              å‹æƒ…é“¾æ¥
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.zhihu.com" title="çŸ¥ä¹" target="_blank">çŸ¥ä¹</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jianshu.com" title="ç®€ä¹¦" target="_blank">ç®€ä¹¦</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.douban.com" title="è±†ç“£" target="_blank">è±†ç“£</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å¯’çŸ³</span>
</div>

<!-- 
<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div> -->


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
