---
title: Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆäºŒï¼‰
date: 2016-06-18 17:16:56
categories: æºç åˆ†æ
tags: [æºç åˆ†æ, Android, Handler]
keywords: æºç åˆ†æ, Android, Handler
comments: true
---

åœ¨ä¸Šä¸€ç‰‡æ–‡ç« ä¸­[Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸€ï¼‰](http://wizardiy.com/2016/06/17/Handler%20%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%80%EF%BC%89/)ä¸­æˆ‘ä»¬åˆ†æåˆ°Handleråœ¨åˆ›å»ºæ—¶ä¼šç»‘å®šä¸€ä¸ª Looper å¯¹è±¡ï¼Œè€ŒLooper å¦‚æœç”¨æˆ·ä¸è¿›è¡Œæ˜¾å¼ä¼ å…¥ï¼Œä¼šåœ¨ Handler ä¸­è°ƒç”¨ Looper.myLooper() æ¥åˆ›å»ºä¸€ä¸ª Looper å¯¹è±¡ã€‚

é‚£ä»€ä¹ˆæ˜¯ Looper å‘¢ï¼Ÿ Android ä¸­å¯¹äº Looper ç±»çš„æ³¨é‡Šä¸­æ˜¯è¿™æ ·æè¿°çš„ï¼šâ€œClass used to run a message loop for a threadâ€ã€‚å¤§æ¦‚æ„æ€æ˜¯æŒ‡è¿™ä¸ªç±»æ˜¯ç”¨æ¥ä¸ºä¸€ä¸ªçº¿ç¨‹åšæ¶ˆæ¯å¾ªç¯ã€‚è€Œ Looper ç±»æœ¬èº«è¢«å£°æ˜ä¸º final ç±»å‹çš„ï¼ŒåŒæ—¶å®ƒçš„æ„é€ æ–¹æ³•ä¹Ÿè¢«å£°æ˜ä¸º final ç±»å‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœè¦è·å–å…¶ä¸­çš„ Looper å®ä¾‹æˆ–è€…ä½¿ç”¨ Looper çš„æ–¹æ³•éœ€è¦ä½¿ç”¨å…¶ä¸­æä¾›çš„ä¸¤ç§é™æ€æ–¹æ³•ï¼š

![](http://upload-images.jianshu.io/upload_images/1489253-6a6158c9a3c87f21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ getMainLooper() æ–¹æ³•è¿˜æ˜¯ myLooper() æ–¹æ³•ï¼Œè·å–çš„ Looper éƒ½æ˜¯ç›´æ¥è¿”å›å·²ç»åˆå§‹åŒ–çš„å¯¹è±¡ã€‚é‚£å®ƒä»¬çš„åˆå§‹åŒ–åœ¨å“ªæ“ä½œçš„å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](http://upload-images.jianshu.io/upload_images/1489253-15a623d946d67366.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸»çº¿ç¨‹ Looper å’Œå­çº¿ç¨‹ Looper åˆ›å»ºçš„åŒºåˆ«åœ¨äºä¸€ä¸ª quitAllowed å˜é‡ï¼ˆä¸»çº¿ç¨‹ä¸º false , å­çº¿ç¨‹ä¸º true ï¼‰ã€‚è€Œæœ€ç»ˆè¿™ä¸ªå˜é‡ä¼šä¼ å…¥åˆ° Looper æ„é€ æ–¹æ³•ä¸­ç”¨äºæ„é€  MessageQueue ã€‚è€Œ Looper ä¸­çš„çº¿ç¨‹ç»‘å®šçš„æ˜¯å½“å‰çº¿ç¨‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](http://upload-images.jianshu.io/upload_images/1489253-8846ed6a2eeca544.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è¿™æ ·çš„è¯ï¼Œç»“åˆä¸Šä¸€ç¯‡ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œç›´æ¥åœ¨å­çº¿ç¨‹ä¸­ä½¿ç”¨ Handler handler = new Handler(),ä¼šè°ƒç”¨ Looper.myLooper() æ–¹æ³•è·å– Looper å¯¹è±¡ï¼Œåœ¨è¿™ä¹‹å‰å¹¶æ²¡æœ‰è°ƒç”¨ Looper.prepare() æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰€ä»¥ sThreadLocal.get() ä¸­ä¼šè¿”å› null ï¼Œè¿›è€ŒæŠ¥é”™ã€‚

é‚£å¤§å®¶æˆ–è®¸ä¼šé—®ï¼Œä¸»çº¿ç¨‹ä¸­çš„ mainLooper æ˜¯ä½•æ—¶è¿›è¡Œåˆå§‹åŒ–çš„å‘¢ï¼Œä¸ºä»€ä¹ˆä¸»çº¿ç¨‹ä¸­ç›´æ¥ new Handler() ä¸ä¼šæŠ¥é”™å‘¢ï¼Ÿå…¶å®è¿™ä¸ªä¸»çº¿ç¨‹ Handler åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±å·²ç»è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œå…·ä½“å¯åŠ¨æ—¶æœºéœ€è¦åœ¨åé¢ç»§ç»­åˆ†æå‘¢ï½ğŸ˜Š

ï¼Špsï¼šåç»­æ–‡ç« ä¼ é€é—¨ï¼šï¼Š

- [Handler æ¶ˆæ¯æœºåˆ¶æºç åˆ†æï¼ˆä¸‰ï¼‰](http://wizardiy.com/2016/08/18/Handler%20%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89/)
